<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon.png">
    <title>Baba Mama Arcade</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000; font-family: -apple-system, sans-serif;
            touch-action: manipulation;
        }
        #border-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 5000; box-sizing: border-box;
            border: 0px solid transparent; 
        }
        .screen { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        .active { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* Animated Neon Borders */
        .neon-yellow { 
            border: 25px solid #FFDE59; 
            animation: pulseYellow 1.5s infinite alternate;
        }
        @keyframes pulseYellow {
            from { box-shadow: inset 0 0 20px #FFDE59, 0 0 20px #FFDE59; border-color: #FFDE59; }
            to { box-shadow: inset 0 0 50px #FFF000, 0 0 50px #FFF000; border-color: #FFF000; }
        }

        .neon-purple { 
            border: 25px solid #A020F0; 
            animation: pulsePurple 1.5s infinite alternate;
        }
        @keyframes pulsePurple {
            from { box-shadow: inset 0 0 20px #A020F0, 0 0 20px #A020F0; border-color: #A020F0; }
            to { box-shadow: inset 0 0 50px #D020FF, 0 0 50px #D020FF; border-color: #D020FF; }
        }

        .neon-jackpot { border: 25px solid #fff; animation: neonFlash 0.2s infinite; }
        @keyframes neonFlash {
            0% { border-color: red; box-shadow: 0 0 40px red; }
            50% { border-color: cyan; box-shadow: 0 0 40px cyan; }
            100% { border-color: magenta; box-shadow: 0 0 40px magenta; }
        }

        img.full { width: 100%; height: 100%; object-fit: cover; }
        .game-photo { width: 100%; height: 100%; object-fit: contain; background: #fff; }
        
        /* Spin Button - Full Screen & Animated */
        #spin-btn { 
            width: 100%; height: 100%; object-fit: cover;
            transition: transform 1.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.8s;
            cursor: pointer;
        }
        .spin-action { transform: scale(0) rotate(1080deg); opacity: 0; }

        .emoji { position: absolute; pointer-events: none; z-index: 4000; }
    </style>
</head>
<body onclick="masterUnlock()">

    <div id="border-overlay"></div>

    <div id="scr-splash" class="screen active"><img src="splash.jpg" class="full"></div>
    <div id="scr-choice" class="screen" onclick="pick(event)"><img src="choice.jpg" class="full"></div>
    <div id="scr-ready" class="screen"><img src="spin.jpg" id="spin-btn" onclick="startTheGame()"></div>
    <div id="scr-game" class="screen"><img id="pic" class="game-photo" src="baba1.jpg"></div>
    <div id="scr-win" class="screen"><img src="win.jpg" class="full"></div>
    <div id="scr-fail" class="screen"><img src="tryagain.jpg" class="full"></div>

    <audio id="s-bg" src="music.mp3" loop playsinline></audio>
    <audio id="s-splash" src="splash.mp3" playsinline></audio>
    <audio id="s-choice" src="choice.mp3" playsinline></audio>
    <audio id="s-spin" src="spin.mp3" playsinline></audio>
    <audio id="s-win" src="win.mp3" playsinline></audio>
    <audio id="s-fail" src="fail.mp3" playsinline></audio>
    <audio id="s-jackpot" src="jackpot.mp3" playsinline></audio>

    <script>
        let userGuess = "", spinCount = 0, unlocked = false;
        let jackpotGoal = Math.floor(Math.random() * 4) + 3;
        const bucket = ["üöí","üöú","üöÄ","üõ∏","ü¶Å","üêò","üê∏","üç¶","üåà","ü¶Ñ","üê∂","üê±","üçé","üçï","ü™ô"];

        let deck = [];
        function refreshDeck() {
            deck = [];
            for(let i=1; i<=10; i++) { deck.push("baba"+i+".jpg"); deck.push("mama"+i+".jpg"); }
            deck.sort(() => Math.random() - 0.5); // Shuffle
        }

        function masterUnlock() {
            if (unlocked) return;
            const allAudios = document.querySelectorAll('audio');
            allAudios.forEach(a => {
                a.play().then(() => { a.pause(); a.currentTime = 0; });
            });
            unlocked = true;
            document.getElementById('s-bg').volume = 0.5;
            document.getElementById('s-bg').play();
            forcePlay('s-splash');
            flow('choice');
        }

        function flow(scr) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById('scr-' + scr).style.display = 'flex';
            document.getElementById('border-overlay').className = "";
        }

        function forcePlay(id) {
            const bg = document.getElementById('s-bg');
            const sfx = document.getElementById(id);
            // "Ducking" logic: Lower music, play SFX, raise music
            bg.volume = 0.1;
            sfx.currentTime = 0;
            sfx.play();
            setTimeout(() => { bg.volume = 0.5; }, 1500);
        }

        function pick(e) {
            userGuess = (e.clientY < window.innerHeight / 2) ? "baba" : "mama";
            forcePlay('s-choice');
            flow('ready');
            document.getElementById('spin-btn').classList.remove('spin-action');
        }

        function startTheGame() {
            document.getElementById('spin-btn').classList.add('spin-action');
            setTimeout(() => { flow('game'); startSpin(); }, 1000);
        }

        function startSpin() {
            if(deck.length < 5) refreshDeck();
            let count = 0;
            const shuffleInterval = setInterval(() => {
                document.getElementById('pic').src = deck[Math.floor(Math.random() * deck.length)];
                forcePlay('s-spin');
                if(++count > 25) { // Longer dramatic shuffle
                    clearInterval(shuffleInterval);
                    finish();
                }
            }, 100);
        }

        function finish() {
            spinCount++;
            let isJP = (spinCount >= jackpotGoal);
            let resultImg = isJP ? "babamama.jpg" : deck.pop();
            let isMama = resultImg.includes("mama");
            
            document.getElementById('pic').src = resultImg;
            const overlay = document.getElementById('border-overlay');
            if(isJP) overlay.className = "neon-jackpot";
            else overlay.className = (isMama ? "neon-purple" : "neon-yellow");

            setTimeout(() => {
                let won = isJP || (isMama && userGuess === "mama") || (!isMama && userGuess === "baba");
                if(won) {
                    if(isJP) { spinCount = 0; jackpotGoal = Math.floor(Math.random()*4)+3; }
                    doWin(isJP, isMama);
                } else { doFail(); }
            }, 4000);
        }

        function doWin(jp, isMama) {
            flow('win');
            if(jp) {
                forcePlay('s-jackpot');
                for(let i=0; i<80; i++) spawn(true, ["ü™ô","üåü","‚ú®"]);
            } else {
                forcePlay('s-win');
                for(let i=0; i<40; i++) spawn(false, isMama ? ["üë©","‚ù§Ô∏è"] : ["üçå","üíõ"]);
            }
            setTimeout(() => flow('choice'), 4500);
        }

        function doFail() {
            flow('fail');
            forcePlay('s-fail');
            for(let i=0; i<40; i++) spawn(false, bucket);
            setTimeout(() => flow('choice'), 3500);
        }

        function spawn(isFirework, list) {
            const el = document.createElement('div');
            el.className = 'emoji';
            el.innerText = list[Math.floor(Math.random()*list.length)];
            el.style.fontSize = (Math.random() * 70 + 30) + "px";
            document.body.appendChild(el);
            let x = Math.random() * window.innerWidth;
            let y = window.innerHeight + 50;
            let vx = (Math.random() - 0.5) * 10;
            let vy = -(Math.random() * 20 + 15);
            if(isFirework) {
                x = window.innerWidth / 2; y = window.innerHeight / 2;
                const angle = Math.random() * Math.PI * 2;
                const speed = Math.random() * 15 + 5;
                vx = Math.cos(angle) * speed; vy = Math.sin(angle) * speed;
            }
            let rot = 0;
            const anim = setInterval(() => {
                x += vx; y += vy; vy += 0.8; rot += 10;
                el.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(${rot}deg)`;
                if(y > window.innerHeight + 200) { clearInterval(anim); el.remove(); }
            }, 20);
        }
    </script>
</body>
</html>

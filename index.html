<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <title>Baba Mama Arcade</title>
    <style>
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background: #000; font-family: -apple-system, sans-serif;
            touch-action: manipulation; -webkit-tap-highlight-color: transparent;
        }
        .screen { display: none; width: 100%; height: 100%; position: absolute; top: 0; left: 0; }
        .active { display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #border-overlay { position: absolute; inset: 0; pointer-events: none; z-index: 5000; border: 0px solid transparent; }
        .neon-jackpot { border: 20px solid #fff; animation: jFlash 0.2s infinite; }
        @keyframes jFlash { 0% { border-color: red; } 50% { border-color: cyan; } 100% { border-color: yellow; } }
        img.full { width: 100%; height: 100%; object-fit: cover; }
        .game-photo { width: 100%; height: 100%; object-fit: contain; background: #fff; }
        #spin-btn { width: 100%; height: 100%; object-fit: cover; transition: transform 0.8s ease-in-out; }
        .spin-action { transform: scale(0) rotate(720deg); }
        .emoji { position: absolute; pointer-events: none; z-index: 4000; font-size: 50px; }
    </style>
</head>
<body onclick="bootAudio()">

    <div id="border-overlay"></div>
    <div id="scr-splash" class="screen active"><img src="splash.jpg" class="full"></div>
    <div id="scr-choice" class="screen" onclick="pick(event)"><img src="choice.jpg" class="full"></div>
    <div id="scr-ready" class="screen"><img src="spin.jpg" id="spin-btn" onclick="startTheGame()"></div>
    <div id="scr-game" class="screen" onclick="checkResult()"><img id="pic" class="game-photo" src="baba1.jpg"></div>
    <div id="scr-win" class="screen"><img src="win.jpg" class="full"></div>
    <div id="scr-fail" class="screen"><img src="tryagain.jpg" class="full"></div>

    <script>
        // --- AUDIO ENGINE ---
        // Switch your .wav files to .mp3 and this will be buttery smooth!
        var sounds = {
            bg:      new Howl({ src: ['music.mp3'], loop: true, volume: 0.4, html5: true }),
            splash:  new Howl({ src: ['splash.mp3'] }),
            choice:  new Howl({ src: ['choice.mp3'] }),
            jackpot: new Howl({ src: ['jackpot.mp3'] }),
            win:     new Howl({ src: ['win.mp3'] }),
            fail:    new Howl({ src: ['fail.mp3'] }),
            spin:    new Howl({ src: ['spin.mp3'] }) // Added the spin sound
        };

        let userGuess = "", spinCount = 0, audioUnlocked = false, isSpinning = false, currentResult = null;
        let jackpotGoal = Math.floor(Math.random() * 4) + 3;

        function bootAudio() {
            if (audioUnlocked) return;
            sounds.bg.play();
            sounds.splash.play();
            audioUnlocked = true;
            flow('choice');
        }

        function flow(scr) {
            document.querySelectorAll('.screen').forEach(s => s.style.display = 'none');
            document.getElementById('scr-' + scr).style.display = 'flex';
            document.getElementById('border-overlay').className = "";
        }

        function pick(e) {
            userGuess = (e.clientY < window.innerHeight / 2) ? "baba" : "mama";
            sounds.choice.play();
            flow('ready');
            document.getElementById('spin-btn').classList.remove('spin-action');
        }

        function startTheGame() {
            document.getElementById('spin-btn').classList.add('spin-action');
            sounds.spin.play();
            setTimeout(() => { flow('game'); startSpin(); }, 800);
        }

        function startSpin() {
            isSpinning = true;
            let count = 0;
            const deck = [];
            for(let i=1; i<=10; i++) { deck.push("baba"+i+".jpg", "mama"+i+".jpg"); }
            
            const shuffleInterval = setInterval(() => {
                document.getElementById('pic').src = deck[Math.floor(Math.random() * deck.length)];
                if(++count > 25) { // Faster spin for SE performance
                    clearInterval(shuffleInterval);
                    isSpinning = false;
                    prepareResult();
                }
            }, 80);
        }

        function prepareResult() {
            spinCount++;
            let isJP = (spinCount >= jackpotGoal);
            let res = isJP ? "babamama.jpg" : (Math.random() > 0.5 ? "baba1.jpg" : "mama1.jpg");
            document.getElementById('pic').src = res;
            currentResult = { isJP, isMama: res.includes("mama") };
            if(isJP) document.getElementById('border-overlay').className = "neon-jackpot";
        }

        function checkResult() {
            if (isSpinning || !currentResult) return;
            let won = currentResult.isJP || (currentResult.isMama && userGuess === "mama") || (!currentResult.isMama && userGuess === "baba");
            if(won) {
                flow('win');
                if(currentResult.isJP) { sounds.jackpot.play(); spinCount = 0; } 
                else { sounds.win.play(); }
            } else {
                flow('fail');
                sounds.fail.play();
            }
            currentResult = null;
            setTimeout(() => flow('choice'), 3500);
        }
    </script>
</body>
</html>
